<%layout("layout/placement/boilerplate.ejs") %>

  <div class="container my-5">
    <!-- Company Header Section -->
    <div class="card mb-4 shadow-sm">
      <div class="card-body">
        <h1 class="display-5 fw-bold mb-3">
          <%= experiance.company %>
        </h1>
        <h2 class="h4 text-muted mb-4">
          <%= experiance.role %>
        </h2>

        <div class="d-flex flex-wrap gap-3 mb-2">
          <span class="badge bg-primary text-white">
            <i class="fas fa-briefcase me-1"></i>
            <%= experiance.jobType %>
          </span>
          <span class="badge bg-secondary text-white">
            <i class="fas fa-calendar-alt me-1"></i>
            <%= new Date(experiance.interviewDate).toLocaleDateString('en-US', { year: 'numeric' , month: 'long' ,
              day: 'numeric' }) %>
          </span>
        </div>
      </div>
    </div>

    <!-- Interview Rounds Section -->
    <% if(experiance.rounds && experiance.rounds.length> 0) { %>
      <div class="card mb-4 shadow-sm">
        <div class="card-header bg-light">
          <h3 class="h5 mb-0"><i class="fas fa-list-ol me-2"></i>Interview Rounds</h3>
        </div>
        <div class="card-body">
          <div class="accordion" id="roundsAccordion">
            <% experiance.rounds.forEach((round, index)=> { %>
              <div class="accordion-item mb-3">
                <h2 class="accordion-header" id="heading<%= index %>">

                  <button class="accordion-button <%= index !== 0 ? 'collapsed' : '' %>" type="button"
                    data-bs-toggle="collapse" data-bs-target="#collapse<%= index %>">
                    <i
                      class="fas fa-<%= round.roundType === 'Technical' ? 'code' : (round.roundType === 'HR' ? 'user-tie' : 'comments') %> me-2"></i>
                    <%= round.roundType %> Round
                      <% if(round.duration) { %>
                        <span class="badge bg-info ms-2">
                          <i class="far fa-clock me-1"></i>
                          <%= round.duration %>
                        </span>
                        <% } %>
                  </button>

                </h2>
                <div id="collapse<%= index %>" class="accordion-collapse collapse <%= index === 0 ? 'show' : '' %>"
                  data-bs-parent="#roundsAccordion">
                  <div class="accordion-body">
                    <% if(round.questions && round.questions.length> 0) { %>
                      <h4 class="h6"><i class="fas fa-question-circle me-1"></i>Questions Asked:</h4>
                      <ul class="list-group list-group-flush mb-3">
                        <% round.questions.forEach(question=> { %>
                          <li class="list-group-item">
                            <%= question.questionText %>
                          </li>
                          <% }); %>
                      </ul>
                      <% } %>

                        <% if(round.experience) { %>
                          <div class="alert alert-light">
                            <strong><i class="fas fa-user me-1"></i>My Experience:</strong>
                            <p class="mb-0">
                              <%= round.experience %>
                            </p>
                          </div>
                          <% } %>
                  </div>
                </div>
              </div>
              <% }); %>
          </div>
        </div>
      </div>
      <% } %>

        <!-- Overall Advice Section -->
        <% if(experiance.overallAdvice) { %>
          <div class="card mb-4 shadow-sm">
            <div class="card-header bg-light">
              <h3 class="h5 mb-0"><i class="fas fa-lightbulb me-2"></i>Overall Advice</h3>
            </div>
            <div class="card-body">
              <blockquote class="blockquote mb-0">
                <p>
                  <%= experiance.overallAdvice %>
                </p>
              </blockquote>
            </div>
          </div>
          <% } %>

            <!-- Comments Section -->
            <div class="card shadow-sm">
              <div class="card-header bg-light">
                <h3 class="h5 mb-0"><i class="fas fa-comments me-2"></i>Community Discussion</h3>
              </div>
              <div class="card-body">
                <!-- Comment Form -->
                <form action="/experiance/<%=experiance._id%>/comment" method="POST" class="mb-4">
                  <div class="mb-3">
                    <label for="comment" class="form-label">Share your thoughts</label>
                    <textarea class="form-control" name="comment" id="comment" rows="3"
                      placeholder="Ask a question or share additional insights about this interview experience..."></textarea>
                  </div>
                  <button type="submit" class="btn btn-primary">
                    <i class="fas fa-paper-plane me-1"></i>Post Comment
                  </button>
                </form>

                <!-- Comments List -->
                <h4 class="h5 mb-3"><i class="fas fa-comment-dots me-1"></i>
                  <%= experiance.comments.length %> Comments
                </h4>

                <% if(experiance.comments.length===0) { %>
                  <div class="text-center py-4 bg-light rounded">
                    <i class="far fa-comment-dots fa-2x mb-2 text-muted"></i>
                    <p class="text-muted">No comments yet. Be the first to share your thoughts!</p>
                  </div>
                  <% } else { %>
                    <div class="list-group">
                      <% experiance.comments.forEach(comment=> { %>
                        <div class="list-group-item">
                          <div class="d-flex">
                            <div class="flex-shrink-0 me-3">
                              <div
                                class="rounded-circle bg-secondary text-white d-flex align-items-center justify-content-center"
                                style="width: 40px; height: 40px;">
                                <%= comment.author ? comment.author.username.charAt(0).toUpperCase() : 'U' %>
                              </div>
                            </div>
                            <div class="flex-grow-1">
                              <div class="d-flex justify-content-between mb-1">
                                <span class="fw-bold">
                                  <%= comment.author ? comment.author.username.toUpperCase() : 'U' || 'Anonymous' %>
                                </span>
                                <small class="text-muted">
                                  <i class="far fa-clock me-1"></i>
                                  <%= new Date(comment.createdAt).toLocaleDateString('en-US', { month: 'short' ,
                                    day: 'numeric' , year: 'numeric' }) %>
                                </small>
                              </div>
                              <p class="mb-2">
                                <%= comment.text %>
                              </p>
                              <div class="d-flex gap-2">
                                <button class="btn btn-sm btn-outline-secondary">
                                  <i class="far fa-thumbs-up me-1"></i>Helpful
                                </button>
                                <button class="btn btn-sm btn-outline-secondary">
                                  <i class="far fa-comment me-1"></i>Reply
                                </button>
                                <% if ( currentUser && ( currentUser.role==="admin" ||
                                  currentUser._id.toString()===comment.author._id.toString() ) ) { %>
                                  <a href="/experiance/<%=experiance._id%>/<%=comment._id %>/delete"
                                    class="btn btn-sm btn-outline-danger ms-auto">
                                    <i class="far fa-trash-alt"></i>
                                  </a>
                                  <% } %>
                              </div>
                            </div>
                          </div>
                        </div>
                        <% }); %>
                    </div>
                    <% } %>
              </div>
            </div>
  </div>